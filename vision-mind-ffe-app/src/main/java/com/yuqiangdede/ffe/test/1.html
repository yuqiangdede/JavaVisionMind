<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>人脸匹配展示</title>
<style>
  .person-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 10px;
  }
  .img-item img {
    width: 100px;
    height: 100px;
    margin-bottom: 5px;
  }
  .matched-img {
    border-bottom: 2px solid black; /* 横线 */
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  .confidence {
    font-size: 12px;
    margin-bottom: 10px;
  }
</style>
</head>
<body>
<div id="images" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>

<script>
// 请求函数，异步获取匹配结果并展示
async function fetchAndDisplayImages() {
  const baseUrl = "http://10.19.169.35:8082/GeoData_mbs/photo/";
  const imagesContainer = document.getElementById('images');
  const excludeId = "0961c33a-c194-4987-aa2a-819279f06113"; // 要排除的人员ID

  for (let i = 1; i <= 100; i++) {
    const imgUrl = `${baseUrl}${i}.jpg`;
    try {
      const response = await fetch('http://127.0.0.1:8286/cscs-face/api/v1/face/search', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          "imgUrl": imgUrl,
          "groupId": "1",
          "confidenceThreshold": 0.55
        })
      });
      const data = await response.json();
      
      if (data.code === "0" && data.data.faceInfo4Search.length > 0) {
        const match = data.data.faceInfo4Search[0];
        const personId = match.id;
        const matchedImgUrl = match.imgUrl;
        const confidence = match.confidence.toFixed(2); // 格式化置信度

        // 检查是否是要排除的人员ID
        if (personId !== excludeId) {
          // 创建或获取当前人员的图片展示区域
          let personDiv = document.getElementById(`person-${personId}`);
          if (!personDiv) {
            personDiv = document.createElement('div');
            personDiv.id = `person-${personId}`;
            personDiv.className = 'person-container';
            imagesContainer.appendChild(personDiv);

            // 添加匹配到的底图
            const baseImgContainer = document.createElement('div');
            baseImgContainer.className = 'img-item matched-img';
            const baseImgElement = document.createElement('img');
            baseImgElement.src = matchedImgUrl;
            baseImgElement.alt = `Base Image`;
            baseImgContainer.appendChild(baseImgElement);
            personDiv.appendChild(baseImgContainer);
          }

          // 添加搜索输入的图片到对应的展示区域及置信度
          const imgElement = document.createElement('img');
          imgElement.src = imgUrl;
          imgElement.alt = `Input Image ${i}`;
          const imgContainer = document.createElement('div');
          imgContainer.className = 'img-item';
          imgContainer.appendChild(imgElement);

          const confidenceElement = document.createElement('div');
          confidenceElement.className = 'confidence';
          confidenceElement.innerText = `Confidence: ${confidence}`;
          imgContainer.appendChild(confidenceElement);

          personDiv.appendChild(imgContainer);
        }
      }
    } catch (error) {
      console.error('Failed to fetch image data:', error);
    }
  }
}

// 页面加载完成后执行
window.onload = function() {
  fetchAndDisplayImages();
};
</script>
</body>
</html>
